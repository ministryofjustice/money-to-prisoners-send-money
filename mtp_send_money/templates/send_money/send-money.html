{% extends 'base.html' %}
{% load i18n %}
{% load send_money moj_utils %}

{% block content %}
  <h1>{% trans 'Who are you sending money to?' %}</h1>

  <form method="post" action=".">
    {% csrf_token %}

    {% if form.errors %}
      <div class="error-summary" aria-labelledby="error-summary-heading" tabindex="-1" role="alert">
        <h1 class="error-summary-heading heading-medium" id="error-summary-heading">{% trans 'There was a problem submitting the form' %}</h1>
        <p>{% trans 'Because of the following problems:' %}</p>
        <ol class="error-summary-list">
          {% for field, errors in form.errors.items %}
            {% with field_obj=form|field_from_name:field %}
              <li>
                {% if field_obj %}
                  <a href="#{{ field_obj.auto_id }}-label">
                  {{ field_obj.label }} —
                {% endif %}
                {% for error in errors %}
                  {% if not forloop.first  %}
                    {% trans 'and' %}
                  {% endif %}
                  {{ error }}
                {% endfor %}
                {% if field_obj %}
                  </a>
                {% endif %}
              </li>
            {% endwith %}
          {% endfor %}
        </ol>
      </div>
    {% endif %}


    {% if preview %}

      <p>
        {% trans 'Please check the details below and click Next if everything is correct.' %}
      </p>
      <dl>
        <dt>{% trans 'Prisoner’s name' %}</dt>
        <dd>{{ form.prisoner_name.value }}</dd>

        <dt>{% trans 'Prisoner’s number' %}</dt>
        <dd>{{ form.prisoner_number.value }}</dd>

        <dt>{% trans 'Prisoner’s date of birth' %}</dt>
        <dd>{{ form.prisoner_dob.value }}</dd>

        <dt>{% trans 'Amount' %}</dt>
        <dd>{{ form.amount.value|currency_format }}</dd>

        <dt>{% trans 'Payment method' %}</dt>
        <dd>{{ form.payment_method.value|payment_method_description }}</dd>
      </dl>

      {{ form }}

      <p>
        <input id="id_next_btn" class="button" type="submit" name="next" value="{% trans 'Next' %}">
        <input id="id_back_btn" class="button button-secondary" type="submit" name="change" value="{% trans 'Go back and change details' %}">
      </p>

        <!-- {{ request.resolver_match.url_name }}.preview -->
    {% else %}

    <fieldset>
      <legend class="form-label-bold">{% trans "Prisoner details" %}</legend>
      <div class="form-group {% if form.prisoner_name.errors %}error{% endif %}">
        <label class="form-label" for="id_prisoner_name">{% trans "Prisoner name" %}</label>
        {% for error in form.prisoner_name.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <input class="form-control" id="id_prisoner_name" name="prisoner_name" type="text"/>
      </div>
      <div class="form-group form-date">
        <label class="form-label">{% trans "Prisoner date of birth" %}</label>
        <div class="form-hint">{% trans "eg 28 04 1996" %}</div>
        <div>
           <div class="form-date-day {% if form.prisoner_dob_day.errors %}error{% endif %}">
             <label class="form-label" for="prisoner_dob_day">{% trans "Day" %}</label>
             {% for error in form.prisoner_dob_day.errors %}
             <span class="error-message">{{ error }}</span>
             {% endfor %}
             <input class="form-control" id="prisoner_dob_day" name="prisoner_dob_day" type="text"/>
           </div>
           <div class="form-date-month {% if form.prisoner_dob_month.errors %}error{% endif %}">
             <label class="form-label" for="prisoner_dob_month">{% trans "Month" %}</label>
             {% for error in form.prisoner_dob_month.errors %}
             <span class="error-message">{{ error }}</span>
             {% endfor %}
             <input class="form-control" id="prisoner_dob_month" name="prisoner_dob_month" type="text"/>
           </div>
           <div class="form-date-year {% if form.prisoner_dob_year.errors %}error{% endif %}">
             <label class="form-label" for="prisoner_dob_year">{% trans "Year" %}</label>
             {% for error in form.prisoner_dob_year.errors %}
             <span class="error-message">{{ error }}</span>
             {% endfor %}
             <input class="form-control" id="prisoner_dob_year" name="prisoner_dob_year" type="text"/>
           </div>
        </div>
      </div>
      <div class="form-group {% if form.prisoner_number.errors %}error{% endif %}">
        <label class="form-label" for="id_prisoner_number">{% trans "Prisoner number" %}</label>
        {% for error in form.prisoner_number.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <div class="form-hint">{% trans "eg a1234bc" %}</div>
        <input class="form-control mtp-prisoner-number" id="id_prisoner_number" name="prisoner_number" type="text"/>
      </div>
    </fieldset>

    <div class="mtp-amount">
      <fieldset>
        <legend class="form-label-bold" for="id_amount">{% trans "How much are you sending?" %}</legend>
        <div class="form-group mtp-money-amount {% if form.amount.errors %}error{% endif %}">
         {% for error in form.amount.errors %}
         <div class="error-message">{{ error }}</div>
         {% endfor %}
         <div class="money-box">
            <div class="form-control">{% trans "£" %}</div><input id="id_amount" class="form-control mtp-charges-amount" name="amount" type="text"/>
         </div>
        </div>
      </fieldset>
      <div class="form-group">
        <fieldset class="mtp-charges-js" style="display:none">
          <p class="form-label">{% trans "Service charge: £" %}<span class="mtp-charges-charges"></span></p>
          <p class="form-hint">{% trans "The service charge is 2.4% of the amount you're sending, plus 20p. This fee is charged by your card provider." %}</p>
          <p class="form-label-bold mtp-charges-total">{% trans "Total to pay: £" %}<span></span></p>
        </fieldset>
        <fieldset class="mtp-charges-no-js">
          <p>{% trans "The service charge is 2.4% of the amount you're sending, plus 20p. This fee is charged by your card provider." %}</p>
          <p>{% trans "For instance, if you want to send £20, you will be charged £20.68" %}</p>
        </fieldset>
      </div>
    </div>

<p><label for="id_payment_method_0">Payment method:</label> <ul id="id_payment_method"><li><label for="id_payment_method_0"><input checked="checked" id="id_payment_method_0" name="payment_method" type="radio" value="debit_card" /> Debit card through this website</label></li>
<li><label for="id_payment_method_1"><input id="id_payment_method_1" name="payment_method" type="radio" value="bank_transfer" /> Bank transfer</label></li></ul></p>

      {# TODO: remove style block once TD allows showing bank transfers #}
      {% if HIDE_BANK_TRANSFER_OPTION %}
        <style type="text/css" scoped>
          #id_payment_method, label[for=id_payment_method_0] {
            display: none;
          }
        </style>
      {% endif %}

      {% csrf_token %}
      {{ form.as_p }}

      <p>
        <input id="id_next_btn" class="button" type="submit" value="{% trans 'Continue' %}">
      </p>

        <!-- {{ request.resolver_match.url_name }}.form -->
    {% endif %}

  </form>
{% endblock %}
