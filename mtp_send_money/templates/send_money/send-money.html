{% extends 'base.html' %}
{% load i18n %}
{% load mtp_common %}
{% load send_money %}

{% block content %}
  <h1>{% trans 'Who are you sending money to?' %}</h1>

  <form method="post" action=".">
    {% csrf_token %}

    {% include 'mtp_common/forms/error-summary.html' with form=form only %}

    <fieldset>
      <legend class="form-label-bold">{% trans "Prisoner details" %}</legend>

      {% include 'mtp_common/forms/field.html' with field=form.prisoner_name only %}

      {% with field=form.prisoner_dob %}
        <div class="form-group form-date {% if field.errors %}error{% endif %}">
          <p>{{ field.label }}</p>
          {% include 'mtp_common/forms/field-errors.html' with field=field only %}
          <div class="form-hint">{% trans "eg 28 04 1996" %}</div>
          <div>
             <div class="form-date-day {% if field.errors %}error{% endif %}">
               <label id="{{ field.auto_id }}_0-label" class="form-label" for="{{ field.auto_id }}_0">{% trans "Day" %}</label>
               <input class="form-control" id="{{ field.auto_id }}_0" name="{{ field.html_name }}_0" value="{{ field.value.0|default:'' }}" type="text"  />
             </div>
             <div class="form-date-month {% if field.errors %}error{% endif %}">
               <label id="{{ field.auto_id }}_1-label" class="form-label" for="{{ field.auto_id }}_1">{% trans "Month" %}</label>
               <input class="form-control" id="{{ field.auto_id }}_1" name="{{ field.html_name }}_1" value="{{ field.value.1|default:'' }}" type="text"  />
             </div>
             <div class="form-date-year {% if field.errors %}error{% endif %}">
               <label id="{{ field.auto_id }}_2-label" class="form-label" for="{{ field.auto_id }}_2">{% trans "Year" %}</label>
               <input class="form-control" id="{{ field.auto_id }}_2" name="{{ field.html_name }}_2" value="{{ field.value.2|default:'' }}" type="text"  />
             </div>
          </div>
        </div>
      {% endwith %}

      {% with field=form.prisoner_number %}
        <div class="form-group {% if field.errors %}error{% endif %}">
          {% include 'mtp_common/forms/field-label.html' with field=field only %}
          {% include 'mtp_common/forms/field-errors.html' with field=field only %}
          <div class="form-hint">{% trans "eg A1234BC" %}</div>
          <input class="form-control mtp-prisoner-number" id="{{ field.id_for_label }}" name="{{ field.html_name }}" value="{{ field.value|default:'' }}" type="text"  />
        </div>
      {% endwith %}
    </fieldset>

    <div class="mtp-details">
      <fieldset>
        <legend class="form-label-bold">{% trans "Your contact details" %}</legend>
        {% include 'mtp_common/forms/field.html' with field=form.email only %}
      </fieldset>
    </div>

    {% with field=form.amount %}
      <div class="mtp-amount">
        <fieldset>
          <legend class="form-label-bold">{% trans "How much are you sending?" %}</legend>

          <label id="{{ field.id_for_label }}-label" class="mtp-hidden" for="{{ field.id_for_label }}">{% trans "Please enter the amount in pounds" %}</label>
          <div class="form-group mtp-money-amount {% if field.errors %}error{% endif %}">
           {% include 'mtp_common/forms/field-errors.html' with field=field only %}
           <div class="money-box">
             <span class="form-control mtp-currency-sign" type="text">
               £
             </span><input id="{{ field.id_for_label }}"
                    class="form-control mtp-charges-amount"
                    maxlength="10"
                    name="{{ field.html_name }}"
                    value="{{ field.value|default:'' }}"
                    type="text"
                    autocomplete="off"
                    data-percentage-charge="{{ service_charge_percentage }}"
                    data-fixed-charge="{{ service_charge_fixed }}" />
           </div>
          </div>
        </fieldset>

        {% if service_charged %}
          <div class="form-group">
            <fieldset class="mtp-charges-js" style="display:none">
              <legend class="form-label">
                {% trans "Service charge:" %}
                <span class="mtp-charges-charges"></span>
              </legend>
              <p class="form-hint">
                {% blocktrans trimmed with charge_percentage=service_charge_percentage|format_percentage charge_fixed=service_charge_fixed|currency_format_pence %}
                  The service charge is {{ charge_percentage }} of the amount you’re sending, plus {{ charge_fixed }}. This fee is charged by your card provider.
                {% endblocktrans %}
              </p>
              <p class="form-label-bold mtp-charges-total">
                {% trans "Total to pay:" %}
                <span></span>
              </p>
            </fieldset>
            <div class="mtp-charges-no-js">
              <p>
                {% blocktrans trimmed with charge_percentage=service_charge_percentage|format_percentage charge_fixed=service_charge_fixed|currency_format_pence %}
                  The service charge is {{ charge_percentage }} of the amount you’re sending, plus {{ charge_fixed }}. This fee is charged by your card provider.
                {% endblocktrans %}
              </p>
              <p>
                {% blocktrans trimmed with sample_amount=sample_amount|currency_format sample_amount_total_charge=sample_amount|add_service_charge|currency_format %}
                  For instance, if you want to send {{ sample_amount }}, you will be charged {{ sample_amount_total_charge }}.
                {% endblocktrans %}
              </p>
            </div>
          </div>
        {% endif %}
      </div>
    {% endwith %}

    {% with field=form.payment_method %}
      {# TODO: remove if block once TD allows showing bank transfers #}
      {% if SHOW_BANK_TRANSFER_OPTION %}

        <div id="{{ field.auto_id }}" class="form-group" style="background: repeating-linear-gradient(-45deg, transparent, transparent 10px, #fee 10px, #fee 20px)">
          <fieldset>
            <legend class="form-label-bold">{{ field.label }}</legend>
            {% for option in field.field.choices %}
              <label class="block-label {% if field.value|to_string == option.0 %}selected{% endif %}">
                <input {% if field.value|to_string == option.0 %}checked="checked"{% endif %} name="{{ field.html_name }}" type="radio" value="{{ option.0 }}"/>
                {{ option.1 }}
              </label>
            {% endfor %}
          </fieldset>
        </div>

      {% else %}

        <input name="{{ field.html_name }}" value="{{ field.value|to_string }}" type="hidden">

      {% endif %}
    {% endwith %}

    <p>
      <input id="id_next_btn" class="button" type="submit" value="{% trans 'Continue' %}">
    </p>
  </form>
{% endblock %}
